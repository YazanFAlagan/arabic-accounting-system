# إعداد جدول التدفق النقدي (Cash Flow Table Setup)

## المشكلة
ظهر خطأ عند محاولة حفظ المصروفات: `Could not find the table 'public.cash_flow' in the schema cache`

هذا يعني أن جدول `cash_flow` غير موجود في قاعدة البيانات.

## الحل

### 1. تطبيق ملف SQL على قاعدة البيانات

قم بتطبيق الملف التالي على قاعدة البيانات في Supabase:
```
database/create_cash_flow_table.sql
```

### 2. خطوات التطبيق في Supabase

1. افتح لوحة تحكم Supabase
2. اذهب إلى قسم "SQL Editor"
3. انسخ محتوى ملف `create_cash_flow_table.sql`
4. الصق المحتوى في محرر SQL
5. اضغط على "Run" لتنفيذ الأوامر

### 3. التحقق من إنشاء الجدول

بعد تنفيذ الأوامر، تحقق من:
- وجود جدول `cash_flow` في قسم "Table Editor"
- وجود الأعمدة المطلوبة
- تفعيل Row Level Security
- إنشاء الفهارس والسياسات

### 4. بنية الجدول

الجدول يحتوي على الأعمدة التالية:
- `id`: معرف فريد
- `type`: نوع المعاملة (income/expense)
- `amount`: الرصيد الحالي بعد المعاملة
- `description`: وصف المعاملة
- `expense_amount`: مبلغ المصروف (للمصروفات)
- `income_amount`: مبلغ الدخل (للإيرادات)
- `payment_method`: طريقة الدفع (project/personal)
- `notes`: ملاحظات
- `created_at`: تاريخ الإنشاء
- `updated_at`: تاريخ التحديث
- `user_id`: معرف المستخدم

### 5. اختبار النظام

بعد تطبيق التحديث:
1. جرب إضافة مصروف جديد
2. تأكد من عدم ظهور خطأ قاعدة البيانات
3. تحقق من تحديث الرصيد في جدول `cash_flow`

## ملاحظات مهمة

- الجدول يدعم Row Level Security لحماية بيانات المستخدمين
- يتم تتبع الرصيد الحالي في عمود `amount`
- يمكن التمييز بين أموال المشروع والأموال الشخصية
- الجدول مُحسن للأداء بفهارس على الأعمدة المهمة
