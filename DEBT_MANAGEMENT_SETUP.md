# نظام إدارة الديون والذمم المدينة - Debt Management System

## نظرة عامة
نظام شامل لإدارة الديون والذمم المدينة يتيح لك تتبع:
- **أموال عليك** (ديون عليك)
- **أموال عليهم** (ديون لهم)
- **المدفوعات والمقبوضات**
- **الرصيد المتبقي**
- **التذكيرات والمواعيد**

## المميزات الرئيسية

### 1. إدارة الأشخاص والجهات
- إضافة وتعديل الأشخاص والشركات
- تصنيف الجهات (فرد، شركة، مورد، عميل)
- تخزين معلومات الاتصال والعناوين

### 2. إدارة الديون
- تسجيل الديون المستحقة عليك وعليهم
- تحديد المبلغ الأصلي والرصيد الحالي
- تعيين تاريخ الاستحقاق والأولوية
- تصنيف الديون حسب الفئة

### 3. تتبع المعاملات
- تسجيل المدفوعات والمقبوضات
- تحديث الرصيد تلقائياً
- تتبع طرق الدفع والأرقام المرجعية

### 4. التقارير والإحصائيات
- عرض إجمالي الأموال المستحقة
- تتبع حالة الديون (نشط، مدفوع، متأخر)
- عرض المعاملات بالتفصيل

## التثبيت والإعداد

### الخطوة 1: تشغيل SQL Script
قم بتشغيل الملف `debt_management_system.sql` في Supabase SQL Editor:

```sql
-- انسخ محتوى الملف debt_management_system.sql
-- والصقه في SQL Editor
-- ثم اضغط Run
```

### الخطوة 2: التحقق من إنشاء الجداول
بعد التشغيل، تأكد من إنشاء الجداول التالية:
- `debt_entities` - الأشخاص والجهات
- `debts` - الديون
- `debt_transactions` - المعاملات
- `debt_reminders` - التذكيرات

### الخطوة 3: الوصول للصفحة
انتقل إلى `/debts` في التطبيق للوصول لنظام إدارة الديون.

## كيفية الاستخدام

### إضافة شخص/جهة جديدة
1. اضغط على "إضافة شخص/جهة"
2. املأ البيانات المطلوبة:
   - الاسم
   - النوع (فرد، شركة، مورد، عميل)
   - معلومات الاتصال
3. اضغط "إضافة"

### إضافة دين جديد
1. اضغط على "إضافة دين"
2. اختر الشخص/الجهة
3. حدد نوع الدين:
   - **أموال عليك**: شخص يدين لك بأموال
   - **أموال عليهم**: أنت مدين لشخص بأموال
4. املأ المبلغ والتفاصيل
5. اضغط "إضافة"

### تسجيل معاملة
1. من جدول الديون، اضغط على أيقونة التعديل
2. أضف معاملة جديدة (دفع أو قبض)
3. سيتم تحديث الرصيد تلقائياً

## الجداول والعلاقات

### جدول debt_entities
```sql
- id: المعرف الفريد
- name: اسم الشخص/الجهة
- type: النوع (individual, company, supplier, customer)
- phone: رقم الهاتف
- email: البريد الإلكتروني
- address: العنوان
- notes: ملاحظات
- user_id: معرف المستخدم
```

### جدول debts
```sql
- id: المعرف الفريد
- entity_id: معرف الشخص/الجهة
- debt_type: نوع الدين (owed_to_me, owed_by_me)
- original_amount: المبلغ الأصلي
- current_balance: الرصيد الحالي
- currency: العملة
- due_date: تاريخ الاستحقاق
- status: الحالة (active, paid, cancelled, overdue)
- description: الوصف
- category: الفئة
- priority: الأولوية (low, normal, high, urgent)
- user_id: معرف المستخدم
```

### جدول debt_transactions
```sql
- id: المعرف الفريد
- debt_id: معرف الدين
- transaction_type: نوع المعاملة (payment, receipt, adjustment)
- amount: المبلغ
- payment_method: طريقة الدفع
- reference_number: الرقم المرجعي
- transaction_date: تاريخ المعاملة
- notes: ملاحظات
- user_id: معرف المستخدم
```

## الـ Views المتاحة

### debt_summary
عرض شامل للديون مع أسماء الأشخاص/الجهات

### debt_balance_summary
إحصائيات إجمالية للديون حسب النوع

### debt_transactions_summary
عرض المعاملات مع التفاصيل الكاملة

## الأمان والصلاحيات

- **Row Level Security (RLS)** مفعل على جميع الجداول
- كل مستخدم يرى فقط بياناته
- صلاحيات كاملة للمستخدمين المسجلين

## التحديثات التلقائية

### Triggers
- **update_debt_balance**: تحديث الرصيد عند إضافة معاملة
- **update_debt_status**: تحديث الحالة حسب الرصيد والتاريخ
- **update_updated_at**: تحديث وقت التعديل

## استكشاف الأخطاء

### مشكلة: لا تظهر البيانات
- تأكد من تسجيل الدخول
- تحقق من تشغيل SQL script
- تأكد من وجود بيانات في الجداول

### مشكلة: خطأ في الصلاحيات
- تأكد من تفعيل RLS
- تحقق من سياسات الأمان
- تأكد من تسجيل الدخول

## الدعم والمساعدة

إذا واجهت أي مشاكل:
1. تحقق من console المتصفح للأخطاء
2. تأكد من تشغيل SQL script بشكل صحيح
3. تحقق من اتصال Supabase

## التطوير المستقبلي

- إضافة نظام تذكيرات تلقائي
- تقارير متقدمة وتحليلات
- تصدير البيانات
- إشعارات في الوقت الفعلي
- دعم العملات المتعددة
- نظام دفع متكامل

---

**ملاحظة**: تأكد من اختبار النظام على بيانات تجريبية قبل استخدامه في الإنتاج.
